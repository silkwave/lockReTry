<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lock Retry Demo</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 40px; background-color: #f4f4f9; }
        .container { max-width: 500px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #333; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; color: #555; }
        input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background-color: #007bff; color: white; border: none; border-radius: 4px; font-size: 16px; cursor: pointer; transition: background 0.3s; }
        button:hover { background-color: #0056b3; }
        #result { margin-top: 20px; padding: 15px; border-radius: 4px; text-align: center; display: none; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info-box { margin-top: 30px; padding: 20px; background: #fff; border: 1px solid #ddd; border-radius: 8px; }
        .info-box h2 { margin-top: 0; font-size: 1.2em; color: #333; border-bottom: 2px solid #007bff; padding-bottom: 10px; margin-bottom: 15px; }
        .info-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #eee; }
        .info-row:last-child { border-bottom: none; }
        .info-label { font-weight: bold; color: #555; }
    </style>
</head>
<body>
<div class="container">
    <h1>계좌 입금 테스트</h1>
    <div class="form-group">
        <label for="accountNo">계좌번호</label>
        <input type="text" id="accountNo" value="123-456" placeholder="계좌번호 입력">
    </div>
    <div class="form-group">
        <label for="amount">입금액</label>
        <input type="number" id="amount" value="1000" placeholder="금액 입력">
    </div>
    <button onclick="deposit()">입금 실행</button>

    <div id="result"></div>

    <div class="info-box">
        <h2>계좌 상세 정보</h2>
        <div class="info-row"><span class="info-label">계좌번호</span><span id="val-accountNo">-</span></div>
        <div class="info-row"><span class="info-label">소유주</span><span id="val-userName">-</span></div>
        <div class="info-row"><span class="info-label">잔액</span><span id="val-balance">-</span></div>
        <div class="info-row"><span class="info-label">최종 수정일</span><span id="val-updateDate">-</span></div>
        <button onclick="loadAccountInfo()" style="margin-top: 15px; background-color: #6c757d;">정보 새로고침</button>
    </div>
</div>

<script>
    async function deposit() {
        const accountNo = document.getElementById('accountNo').value;
        const amount = document.getElementById('amount').value;
        const resultDiv = document.getElementById('result');

        resultDiv.style.display = 'block';
        resultDiv.className = '';
        resultDiv.innerText = "처리 중...";
        resultDiv.style.backgroundColor = "#eee";
        resultDiv.style.color = "#333";

        try {
            const response = await fetch(`/api/deposit?accountNo=${accountNo}&amount=${amount}`, { method: 'POST' });
            const text = await response.text();
            
            resultDiv.className = response.ok ? 'success' : 'error';
            resultDiv.innerText = text;
            if (response.ok) {
                loadAccountInfo();
            }
        } catch (error) {
            resultDiv.className = 'error';
            resultDiv.innerText = "통신 에러: " + error.message;
        }
    }

    async function loadAccountInfo() {
        const accountNo = document.getElementById('accountNo').value;
        if (!accountNo) return;

        try {
            const response = await fetch(`/api/account/${accountNo}`);
            if (response.ok) {
                const data = await response.json();
                document.getElementById('val-accountNo').innerText = data.accountNo;
                document.getElementById('val-userName').innerText = data.userName;
                document.getElementById('val-balance').innerText = new Intl.NumberFormat('ko-KR').format(data.balance) + "원";
                document.getElementById('val-updateDate').innerText = new Date(data.updateDate).toLocaleString();
            }
        } catch (e) {
            console.error("정보 조회 실패", e);
        }
    }
    
    // 초기 로드 시 조회
    window.onload = loadAccountInfo;
</script>
</body>
</html>
